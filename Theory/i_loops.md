# Распараллеливание вложенных циклов

Как и в прошлом случае, рассматриваем только циклы со счётчиком.

Вложенные циклы тоже задают итерационное пространство - на этот раз многомерное (в соответствии с количеством циклов).
Соответственно, одной итерации мы можем поставить в соответствие **итерационный вектор**.
Итерационные векторы легко упорядочить (использовать порядок исполнения).

Так же, как и в случае одномерного цикла, в случае зависимости по данным можем определить вектор истока **K**, вектор стока **L** и вектор расстояний **D = L - K**.

По вектору расстояний непросто сделать заключение о возможности распараллелить цикл. 
Для этого вводим **вектор направлений d**, той же размерности что и **D**, компоненты которого принимают одно из трёх символьных значений:
- d<sub>i</sub> = "=", если D<sub>i</sub> = 0
- d<sub>i</sub> = "<", если D<sub>i</sub> > 0
- d<sub>i</sub> = ">", если D<sub>i</sub> < 0

В частности, если все компоненты вектора направлений равны "=", то имеем loop-independent dependence, и вложенные циклы можно менять местами.

### Примеры

```fortran
do j = 1,a
	do i = 1,b
		a(i,j) = a(i,j+1) * 2
	end do
end do
```

В таком случае вектор направлений имеет вид (">", "="). Это значит, что можно параллелить внутренний цикл без ограничений.
Внешний тоже, если размножить входные данные.


```fortran
do j = 1,a
	do i = 1,b
		a(i,j) = a(i,j-1) * 2
	end do
end do
```

В таком случае вектор направлений имеет вид ("<", "="). Это значит, что можно параллелить внутренний цикл без ограничений.
Внутренний - нельзя, очевидно, так как вырисовывается цепочка операторов.
Если бы вместо `j-1` в коде было бы `j-2` - то по внешнему циклу тоже можно распараллелить, но не более чем на 2 исполнителя.


```fortran
do j = 1,a
	do i = 1,b
		a(i,j) = a(i+1,j-1) * 2
	end do
end do
```


В таком случае вектор направлений имеет вид ("<", ">"). 

## Важные выводы

- Истинная зависимость имеет место, только если крайний левый элемент вектора направлений, отличный от "=", равен "<"
- Два соседних вложенных цикла можно поменять местами в последовательной программе, если:
	- Один из них имеет значение "=" в соотв. компоненте вектора направлений
- Антизависимость можно смело параллелить с помощью размножения исходных данных или барьерной синхронизации

----

[На главную](../Readme.md)